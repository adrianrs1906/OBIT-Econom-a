<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBIT - Inteligencia Turística Cali-Baja</title>
    
    <!-- Librerías Externas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: {
                        obit: {
                            primary: '#0f4c75',    // Azul profundo (Confianza/Institucional)
                            secondary: '#3282b8',  // Azul médico/tecnológico
                            accent: '#bbe1fa',     // Acento claro
                            success: '#10b981',    // Verde Sostenibilidad
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f8fafc; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .transition-all { transition: all 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="text-slate-700 font-sans antialiased">

    <!-- Navbar con Enfoque en Datos/Interoperabilidad -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center gap-4">
                    <div class="bg-obit-primary p-2 rounded-lg text-white">
                        <i class="fa-solid fa-network-wired text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold tracking-tight text-obit-primary">OBIT <span class="font-light text-gray-400">| Cali-Baja</span></h1>
                        <p class="text-xs text-gray-500">Sistema de Gobernanza Digital e Inteligencia de Datos</p>
                    </div>
                </div>
                <div class="hidden md:flex items-center gap-4">
                    <!-- Indicador de Interoperabilidad (Mencionado en PDF: HL7 FHIR) -->
                    <div class="flex items-center gap-2 px-3 py-1 bg-green-50 text-green-700 rounded-full text-xs font-medium border border-green-200">
                        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                        Interoperabilidad HL7 FHIR: Activa
                    </div>
                    <span class="text-gray-400 text-sm">v2.4.0 (Beta)</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <!-- Header Contextual -->
        <div class="mb-8 animate-fade-in">
            <h2 class="text-2xl font-bold text-gray-800">Tablero de Control Regional</h2>
            <p class="text-gray-500">Monitoreo de indicadores económicos, sostenibilidad y acreditaciones en tiempo real.</p>
        </div>

        <!-- Filters Section -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-8 border-l-4 border-obit-secondary animate-fade-in">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                <!-- Filtro Año -->
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">Periodo Fiscal</label>
                    <select id="yearFilter" onchange="updateDashboard()" class="block w-full border-gray-300 rounded-lg bg-gray-50 text-sm focus:ring-obit-secondary focus:border-obit-secondary p-2.5">
                        <option value="all">Histórico (2022-2024)</option>
                        <option value="2024" selected>2024 (Actual)</option>
                        <option value="2023">2023</option>
                    </select>
                </div>

                <!-- Filtro Cluster (CRÍTICO para el PDF) -->
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">Cluster Estratégico</label>
                    <select id="clusterFilter" onchange="updateDashboard()" class="block w-full border-gray-300 rounded-lg bg-gray-50 text-sm focus:ring-obit-secondary focus:border-obit-secondary p-2.5">
                        <option value="all">Visión General</option>
                        <option value="Medico">Turismo Médico & Wellness</option>
                        <option value="Gastronomico">Gastronomía y Enología</option>
                        <option value="Negocios">MICE (Negocios/Convenciones)</option>
                    </select>
                </div>

                <!-- Filtro Origen -->
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2">Origen del Visitante</label>
                    <select id="originFilter" onchange="updateDashboard()" class="block w-full border-gray-300 rounded-lg bg-gray-50 text-sm focus:ring-obit-secondary focus:border-obit-secondary p-2.5">
                        <option value="all">Todos los orígenes</option>
                        <option value="California">California (USA)</option>
                        <option value="Nevada">Nevada (USA)</option>
                        <option value="Nacional">Nacional (MX)</option>
                    </select>
                </div>

                <!-- Botón Reset -->
                <div>
                    <button onclick="resetFilters()" class="w-full bg-slate-100 hover:bg-slate-200 text-slate-600 font-medium py-2.5 px-4 rounded-lg transition-colors text-sm">
                        <i class="fa-solid fa-rotate-right mr-2"></i> Restablecer
                    </button>
                </div>
            </div>
        </div>

        <!-- KPI Cards - Alineados a "Transparencia y Sostenibilidad" -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 animate-fade-in" style="animation-delay: 0.1s;">
            
            <!-- KPI 1: Flujo Económico -->
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover relative">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-xs font-bold text-gray-400 uppercase">Derrama Económica</p>
                        <h3 class="text-2xl font-bold text-gray-800 mt-1" id="kpi-spending">Loading...</h3>
                    </div>
                    <div class="bg-blue-50 p-2 rounded-lg text-obit-primary"><i class="fa-solid fa-chart-line"></i></div>
                </div>
                <div class="text-xs text-green-600 font-medium bg-green-50 inline-block px-2 py-1 rounded">
                    +14.2% vs año anterior
                </div>
            </div>

            <!-- KPI 2: Confianza / Acreditaciones (Vital para el PDF) -->
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover relative">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-xs font-bold text-gray-400 uppercase">Proveedores Acreditados</p>
                        <h3 class="text-2xl font-bold text-gray-800 mt-1" id="kpi-providers">142</h3>
                    </div>
                    <div class="bg-purple-50 p-2 rounded-lg text-purple-600"><i class="fa-solid fa-certificate"></i></div>
                </div>
                <div class="text-xs text-gray-500">
                    Clínicas con JCI / CSG vigentes
                </div>
            </div>

            <!-- KPI 3: Satisfacción / Confianza -->
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover relative">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-xs font-bold text-gray-400 uppercase">Índice de Confianza</p>
                        <h3 class="text-2xl font-bold text-gray-800 mt-1">94.8%</h3>
                    </div>
                    <div class="bg-yellow-50 p-2 rounded-lg text-yellow-600"><i class="fa-solid fa-shield-heart"></i></div>
                </div>
                <div class="text-xs text-gray-500">
                    Basado en encuestas post-servicio
                </div>
            </div>

            <!-- KPI 4: Sostenibilidad (Mencionado en PDF) -->
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 card-hover relative">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <p class="text-xs font-bold text-gray-400 uppercase">Huella Hídrica/Turista</p>
                        <h3 class="text-2xl font-bold text-gray-800 mt-1">-5%</h3>
                    </div>
                    <div class="bg-green-50 p-2 rounded-lg text-green-600"><i class="fa-solid fa-leaf"></i></div>
                </div>
                <div class="text-xs text-gray-500">
                    Objetivo de sostenibilidad 2025
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8 animate-fade-in" style="animation-delay: 0.2s;">
            
            <!-- Chart 1: Demanda por Cluster -->
            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <h3 class="text-sm font-bold text-gray-700 mb-6 flex items-center gap-2">
                    <i class="fa-solid fa-hospital-user text-obit-secondary"></i> Demanda de Servicios por Cluster (2024)
                </h3>
                <div class="h-64 relative w-full">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <!-- Chart 2: Origen del Paciente/Turista -->
            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                <h3 class="text-sm font-bold text-gray-700 mb-6 flex items-center gap-2">
                    <i class="fa-solid fa-location-dot text-obit-secondary"></i> Origen del Flujo
                </h3>
                <div class="h-64 relative w-full flex justify-center">
                    <canvas id="originChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tabla de Transparencia de Datos -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden animate-fade-in" style="animation-delay: 0.3s;">
            <div class="p-6 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                <div>
                    <h3 class="text-sm font-bold text-gray-800">Directorio de Calidad & Precios</h3>
                    <p class="text-xs text-gray-500">Datos para reducir asimetría de información (Objetivo OBIT)</p>
                </div>
                <button class="text-xs bg-white border border-gray-300 px-3 py-1 rounded hover:bg-gray-50">
                    <i class="fa-solid fa-download mr-1"></i> Exportar CSV
                </button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-slate-50 text-slate-500 uppercase text-xs font-bold tracking-wider">
                        <tr>
                            <th class="px-6 py-4 border-b">Entidad / Cluster</th>
                            <th class="px-6 py-4 border-b">Acreditación</th>
                            <th class="px-6 py-4 border-b text-right">Visitantes (Año)</th>
                            <th class="px-6 py-4 border-b text-right">Ticket Promedio</th>
                            <th class="px-6 py-4 border-b text-center">Nivel de Confianza</th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody" class="text-sm text-gray-700 divide-y divide-gray-100">
                        <!-- Filled by JS -->
                    </tbody>
                </table>
            </div>
        </div>

    </div>

    <!-- Script Lógico -->
    <script>
        // --- 1. Generación de Datos Simulada (Mock Data) ---
        // Simulamos datos que mezclan clusters médicos y turísticos
        const generateData = () => {
            const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
            const clusters = ['Medico', 'Gastronomico', 'Negocios'];
            const origins = ['California', 'Nevada', 'Nacional'];
            
            let data = [];

            // Generamos datos para 2023 y 2024
            [2023, 2024].forEach(year => {
                months.forEach(month => {
                    clusters.forEach(cluster => {
                        // Lógica base: El turismo médico es más estable, gastronomico tiene picos
                        let base = cluster === 'Medico' ? 4000 : 2500;
                        let multiplier = year === 2024 ? 1.15 : 1.0; // Crecimiento anual
                        
                        let visitors = Math.floor(base * multiplier + Math.random() * 500);
                        // Ticket promedio más alto en médico
                        let ticket = cluster === 'Medico' ? 1200 : (cluster === 'Negocios' ? 800 : 150); 
                        let spending = visitors * ticket;

                        data.push({ year: year.toString(), month, cluster, visitors, spending, origins: {
                            California: Math.floor(visitors * 0.65), // 65% de California (Cali-Baja)
                            Nevada: Math.floor(visitors * 0.15),
                            Nacional: Math.floor(visitors * 0.20)
                        }});
                    });
                });
            });
            return data;
        };

        const db = generateData();
        let charts = {};

        // --- 2. Lógica de Filtrado ---
        function getFilteredData() {
            const yearVal = document.getElementById('yearFilter').value;
            const clusterVal = document.getElementById('clusterFilter').value;
            // Nota: Origin filter se usa para recalcular totales visuales, no filtra filas base en este demo simple

            return db.filter(row => {
                const matchYear = yearVal === 'all' || row.year === yearVal;
                const matchCluster = clusterVal === 'all' || row.cluster === clusterVal;
                return matchYear && matchCluster;
            });
        }

        const formatCurrency = (num) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(num);
        const formatNumber = (num) => new Intl.NumberFormat('es-MX').format(num);

        // --- 3. Actualización de UI ---
        function updateDashboard() {
            const data = getFilteredData();
            const yearFilter = document.getElementById('yearFilter').value;
            const originFilter = document.getElementById('originFilter').value;

            // --- Update KPIs ---
            // Calcular Gasto total basado en filtro de origen (simulado)
            let totalSpending = 0;
            let totalVisitors = 0;

            data.forEach(d => {
                let factor = 1;
                if(originFilter === 'California') factor = 0.65;
                if(originFilter === 'Nevada') factor = 0.15;
                if(originFilter === 'Nacional') factor = 0.20;
                
                totalSpending += (d.spending * factor);
                totalVisitors += (d.visitors * factor);
            });

            document.getElementById('kpi-spending').innerText = formatCurrency(totalSpending);
            
            // KPI Proveedores (Hardcoded logic for demo awareness)
            const clusterVal = document.getElementById('clusterFilter').value;
            let providers = clusterVal === 'Medico' ? 85 : (clusterVal === 'Gastronomico' ? 210 : 142);
            document.getElementById('kpi-providers').innerText = providers;

            // --- Update Table ---
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            
            // Agrupamos datos para la tabla (Resumen por Cluster si 'all', o detalle mensual si filtrado)
            const clustersToShow = ['Medico', 'Gastronomico', 'Negocios'];
            
            clustersToShow.forEach(c => {
                // Si hay filtro de cluster y no coincide, saltar
                if(clusterVal !== 'all' && clusterVal !== c) return;

                // Datos anuales para este cluster
                const clusterData = data.filter(d => d.cluster === c);
                const sumVisitors = clusterData.reduce((acc, curr) => acc + curr.visitors, 0);
                const avgTicket = clusterData.length ? (clusterData.reduce((acc, curr) => acc + (curr.spending/curr.visitors), 0) / clusterData.length) : 0;

                // Definir certificaciones según el tipo (Simulando "Transparencia")
                let cert = c === 'Medico' ? 'JCI / CSG / ISO' : (c === 'Gastronomico' ? 'Distintivo H / Michelin' : 'Safe Travels');
                let trust = c === 'Medico' ? '98.5%' : '92.0%';

                const tr = document.createElement('tr');
                tr.className = 'hover:bg-slate-50 transition-colors border-b border-gray-50';
                tr.innerHTML = `
                    <td class="px-6 py-4 font-medium text-gray-800">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500">
                                <i class="fa-solid ${c === 'Medico' ? 'fa-user-doctor' : (c === 'Gastronomico' ? 'fa-utensils' : 'fa-briefcase')}"></i>
                            </div>
                            ${c === 'Medico' ? 'Cluster Médico' : c}
                        </div>
                    </td>
                    <td class="px-6 py-4 text-xs font-semibold text-gray-500"><span class="bg-green-100 text-green-700 px-2 py-1 rounded border border-green-200">${cert}</span></td>
                    <td class="px-6 py-4 text-right font-medium">${formatNumber(sumVisitors)}</td>
                    <td class="px-6 py-4 text-right text-gray-600">${formatCurrency(avgTicket)}</td>
                    <td class="px-6 py-4 text-center">
                        <div class="flex items-center justify-center gap-1 text-green-600 font-bold text-xs">
                            <i class="fa-solid fa-star"></i> ${trust}
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });

            // --- Update Charts ---
            updateCharts(data, yearFilter);
        }

        function updateCharts(data, yearFilter) {
            const ctxTrend = document.getElementById('trendChart').getContext('2d');
            const ctxOrigin = document.getElementById('originChart').getContext('2d');

            // 1. Chart de Demanda (Barras agrupadas o Línea de tendencia)
            // Agrupamos por mes
            const months = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
            
            // Datos Medicos vs Ocio
            const medicalData = months.map(m => data.filter(d => d.month === m && d.cluster === 'Medico').reduce((a, b) => a + b.visitors, 0));
            const leisureData = months.map(m => data.filter(d => d.month === m && d.cluster !== 'Medico').reduce((a, b) => a + b.visitors, 0));

            if (charts.trend) charts.trend.destroy();

            charts.trend = new Chart(ctxTrend, {
                type: 'line',
                data: {
                    labels: months,
                    datasets: [
                        {
                            label: 'Turismo Médico (Prioridad)',
                            data: medicalData,
                            borderColor: '#0f4c75', // Primary
                            backgroundColor: 'rgba(15, 76, 117, 0.1)',
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Turismo Ocio/Negocios',
                            data: leisureData,
                            borderColor: '#3282b8', // Secondary
                            borderDash: [5, 5],
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: { y: { beginAtZero: true } }
                }
            });

            // 2. Chart de Origen (Dona - Enfatizando Cali-Baja)
            // Calculamos totales estáticos basados en porcentajes simulados
            const totalVis = data.reduce((a, b) => a + b.visitors, 0);
            const caliData = Math.floor(totalVis * 0.65);
            const nevadaData = Math.floor(totalVis * 0.15);
            const mxData = Math.floor(totalVis * 0.20);

            if (charts.origin) charts.origin.destroy();

            charts.origin = new Chart(ctxOrigin, {
                type: 'doughnut',
                data: {
                    labels: ['California (Cali-Baja)', 'Nevada/Otros USA', 'Nacional MX'],
                    datasets: [{
                        data: [caliData, nevadaData, mxData],
                        backgroundColor: ['#0f4c75', '#3282b8', '#bbe1fa'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, padding: 15 } }
                    }
                }
            });
        }

        function resetFilters() {
            document.getElementById('yearFilter').value = '2024';
            document.getElementById('clusterFilter').value = 'all';
            document.getElementById('originFilter').value = 'all';
            updateDashboard();
        }

        window.addEventListener('DOMContentLoaded', updateDashboard);
    </script>
</body>
</html>
